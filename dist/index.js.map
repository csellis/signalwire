{"version":3,"sources":["index.js"],"names":["SignalWireEmbed","scriptElm","params","client","currentCall","ready","callback","document","readyState","addEventListener","attachEvent","setup","getElementById","url","URL","src","URLSearchParams","search","cssUrl","href","split","replace","createMainDiv","injectStylesheet","injectScripts","mainDiv","createElement","innerText","style","remoteVideo","autoplay","playsInline","id","startCallBtn","type","connect","hangupBtn","hangup","appendChild","parentNode","insertBefore","link","rel","head","append","injectScript","then","console","log","setupClient","Promise","resolve","reject","script","e","error","clientParams","host","get","login","password","callerName","callerNumber","Verto","remoteElement","iceServers","urls","enableMicrophone","enableWebcam","on","startCall","handleNotification","display","destinationNumber","audio","video","newCall","notification","handleCallUpdate","call","state","handleCallActive"],"mappings":"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","file":"index.js","sourceRoot":"..","sourcesContent":["var SignalWireEmbed = {\n  scriptElm: null,\n  params: null,\n  client: null,\n  currentCall: null,\n  ready: function (callback) {\n    if (document.readyState != \"loading\") {\n      callback();\n    } else if (document.addEventListener) {\n      document.addEventListener(\"DOMContentLoaded\", callback);\n    } else {\n      document.attachEvent(\"onreadystatechange\", function () {\n        if (document.readyState != \"loading\") {\n          callback();\n        }\n      });\n    }\n  },\n\n  setup: function () {\n    this.scriptElm = document.getElementById(\"signalwire-embed\");\n    var url = new URL(this.scriptElm.src);\n    this.params = new URLSearchParams(url.search);\n\n    var cssUrl = url.href.split(\"?\")[0].replace(\"js\", \"css\");\n\n    this.createMainDiv();\n    this.injectStylesheet(cssUrl);\n    this.injectScripts();\n  },\n\n  createMainDiv: function () {\n    var mainDiv = document.createElement(\"div\");\n    mainDiv.innerText = \"Embed Div\";\n    mainDiv.style = \"width: 800px; height: 600px; position: relative;\";\n\n    var remoteVideo = document.createElement(\"video\");\n    remoteVideo.autoplay = true;\n    remoteVideo.playsInline = true;\n    remoteVideo.id = \"signalWireRemoteVideo\";\n    remoteVideo.style = \"background-color: black; width: 800px; height: 600px;\";\n\n    // var localVideo = document.createElement('video');\n    // localVideo.autoplay = true;\n    // localVideo.playsInline = true;\n    // localVideo.id = \"signalWireLocalVideo\";\n    // localVideo.style = \"background-color: black; width: 400px; height: 300px;\"\n\n    var startCallBtn = document.createElement(\"button\");\n    startCallBtn.type = \"button\";\n    startCallBtn.id = \"startCallBtn\";\n    startCallBtn.innerText = \"Join the room\";\n    startCallBtn.style = \"position:absolute; left:50%; top:50%; transform: translate(-50%, -50%)\";\n    startCallBtn.addEventListener(\"click\", function () {\n      SignalWireEmbed.connect();\n    });\n\n    var hangupBtn = document.createElement(\"button\");\n    hangupBtn.type = \"button\";\n    hangupBtn.id = \"hangupBtn\";\n    hangupBtn.innerText = \"Hang up\";\n    hangupBtn.style = \"position:absolute; left:50%; bottom: 5%; transform: translate(-50%, -5%); display: none\";\n    hangupBtn.addEventListener(\"click\", function () {\n      SignalWireEmbed.hangup();\n    });\n\n    mainDiv.appendChild(remoteVideo);\n    // mainDiv.appendChild(localVideo);\n    mainDiv.appendChild(startCallBtn);\n    mainDiv.appendChild(hangupBtn);\n\n    this.scriptElm.parentNode.insertBefore(mainDiv, this.scriptElm);\n  },\n  injectStylesheet: function (src) {\n    var link = document.createElement(\"link\");\n    link.href = src;\n    link.rel = \"stylesheet\";\n    document.head.append(link);\n  },\n  injectScripts: function () {\n    this.injectScript(\"https://webrtc.github.io/adapter/adapter-latest.js\").then(() => {\n      this.injectScript(\"https://unpkg.com/@signalwire/js\").then(() => {\n        console.log(\"Scripts loaded!\");\n        this.setupClient();\n      });\n    });\n  },\n  injectScript: function (src) {\n    return new Promise((resolve, reject) => {\n      const script = document.createElement(\"script\");\n      script.src = src;\n      script.addEventListener(\"load\", resolve);\n      script.addEventListener(\"error\", (e) => reject(e.error));\n      document.head.appendChild(script);\n    });\n  },\n  setupClient: function () {\n    var clientParams = {\n      host: this.params.get(\"node\") + \".sw.work/freeswitch\",\n      login: \"guest\",\n      password: \"signalwire\",\n      callerName: this.params.get(\"user\"),\n      callerNumber: \"guest\",\n    };\n\n    var client = new Verto(clientParams);\n\n    client.remoteElement = \"signalWireRemoteVideo\";\n    // client.localElement = 'signalWireLocalVideo';\n    client.iceServers = [{ urls: [\"stun:stun.l.google.com:19302\"] }];\n    client.enableMicrophone();\n    client.enableWebcam();\n\n    client.on(\"signalwire.ready\", function () {\n      console.log(\"Connected\");\n      // here we will dial the call\n      SignalWireEmbed.startCall();\n    });\n\n    // Update UI on socket close\n    client.on(\"signalwire.socket.close\", function () {\n      console.log(\"Disconnected\");\n    });\n\n    // Handle error...\n    client.on(\"signalwire.error\", function (error) {\n      console.error(\"SignalWire error:\", error);\n    });\n\n    client.on(\"signalwire.notification\", SignalWireEmbed.handleNotification);\n    this.client = client;\n    console.log(\"Client is set up\");\n  },\n  // call this from the button handler\n  connect: function () {\n    document.getElementById(\"startCallBtn\").style.display = \"none\";\n    this.client.connect();\n  },\n\n  startCall: function () {\n    console.log(\"calling\", this.params.get(\"room\"));\n    const params = {\n      destinationNumber: this.params.get(\"room\"),\n      audio: true,\n      video: true,\n    };\n\n    SignalWireEmbed.currentCall = SignalWireEmbed.client.newCall(params);\n  },\n  handleNotification: function (notification) {\n    console.log(\"notification\", notification.type, notification);\n    switch (notification.type) {\n      case \"callUpdate\":\n        SignalWireEmbed.handleCallUpdate(notification.call);\n        break;\n      case \"userMediaError\":\n        // Permission denied or invalid audio/video params on `getUserMedia`\n        console.log(\"There was an userMediaError\");\n        break;\n    }\n  },\n\n  handleCallUpdate: function (call) {\n    switch (call.state) {\n      case \"active\": // Call has become active\n        SignalWireEmbed.handleCallActive();\n        break;\n      case \"destroy\": // Call has been destroyed\n        console.log(\"call was destroyed\");\n        document.getElementById(\"hangupBtn\").style.display = \"none\";\n        document.getElementById(\"startCallBtn\").style.display = \"block\";\n        SignalWireEmbed.currentCall = null;\n        break;\n    }\n  },\n\n  handleCallActive: function () {\n    console.log(\"call has become active\");\n    document.getElementById(\"hangupBtn\").style.display = \"block\";\n    document.getElementById(\"startCallBtn\").style.display = \"none\";\n  },\n  hangup: function () {\n    console.log(\"hanging up\");\n    if (SignalWireEmbed.currentCall) {\n      SignalWireEmbed.currentCall.hangup();\n    }\n  },\n};\n\nSignalWireEmbed.ready(function () {\n  SignalWireEmbed.setup();\n});\n"]}